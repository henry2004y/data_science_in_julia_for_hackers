<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 11 Ultima online | Data Science in Julia for Hackers</title>
  <meta name="description" content="Chapter 11 Ultima online | Data Science in Julia for Hackers" />
  <meta name="generator" content="bookdown 0.29 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 11 Ultima online | Data Science in Julia for Hackers" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Chapter 11 Ultima online | Data Science in Julia for Hackers" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 11 Ultima online | Data Science in Julia for Hackers" />
  
  <meta name="twitter:description" content="Chapter 11 Ultima online | Data Science in Julia for Hackers" />
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="image-classification.html"/>
<link rel="next" href="ultima-continued.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Data Science in Julia for Hackers</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#prologue"><i class="fa fa-check"></i>Prologue</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="science-technology-and-epistemology.html"><a href="science-technology-and-epistemology.html"><i class="fa fa-check"></i><b>1</b> Science technology and epistemology</a>
<ul>
<li class="chapter" data-level="1.1" data-path="science-technology-and-epistemology.html"><a href="science-technology-and-epistemology.html#the-difference-between-science-and-technology"><i class="fa fa-check"></i><b>1.1</b> The difference between Science and Technology</a></li>
<li class="chapter" data-level="1.2" data-path="science-technology-and-epistemology.html"><a href="science-technology-and-epistemology.html#what-is-technology"><i class="fa fa-check"></i><b>1.2</b> What is technology?</a></li>
<li class="chapter" data-level="1.3" data-path="science-technology-and-epistemology.html"><a href="science-technology-and-epistemology.html#references"><i class="fa fa-check"></i><b>1.3</b> References</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="meeting-julia.html"><a href="meeting-julia.html"><i class="fa fa-check"></i><b>2</b> Meeting Julia</a>
<ul>
<li class="chapter" data-level="2.1" data-path="meeting-julia.html"><a href="meeting-julia.html#why-julia"><i class="fa fa-check"></i><b>2.1</b> Why Julia</a></li>
<li class="chapter" data-level="2.2" data-path="meeting-julia.html"><a href="meeting-julia.html#julia-presentation"><i class="fa fa-check"></i><b>2.2</b> Julia presentation</a></li>
<li class="chapter" data-level="2.3" data-path="meeting-julia.html"><a href="meeting-julia.html#installation"><i class="fa fa-check"></i><b>2.3</b> Installation</a></li>
<li class="chapter" data-level="2.4" data-path="meeting-julia.html"><a href="meeting-julia.html#first-steps-into-the-julia-world"><i class="fa fa-check"></i><b>2.4</b> First steps into the Julia world</a></li>
<li class="chapter" data-level="2.5" data-path="meeting-julia.html"><a href="meeting-julia.html#julias-ecosystem-basic-plotting-and-manipulation-of-dataframes"><i class="fa fa-check"></i><b>2.5</b> Julia’s Ecosystem: Basic plotting and manipulation of DataFrames</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="meeting-julia.html"><a href="meeting-julia.html#plotting-with-plots.jl"><i class="fa fa-check"></i><b>2.5.1</b> Plotting with Plots.jl</a></li>
<li class="chapter" data-level="2.5.2" data-path="meeting-julia.html"><a href="meeting-julia.html#introducing-dataframes.jl"><i class="fa fa-check"></i><b>2.5.2</b> Introducing DataFrames.jl</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="meeting-julia.html"><a href="meeting-julia.html#summary"><i class="fa fa-check"></i><b>2.6</b> Summary</a></li>
<li class="chapter" data-level="2.7" data-path="meeting-julia.html"><a href="meeting-julia.html#references-1"><i class="fa fa-check"></i><b>2.7</b> References</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="probability-introduction.html"><a href="probability-introduction.html"><i class="fa fa-check"></i><b>3</b> Probability introduction</a>
<ul>
<li class="chapter" data-level="3.1" data-path="probability-introduction.html"><a href="probability-introduction.html#introduction-to-probability"><i class="fa fa-check"></i><b>3.1</b> Introduction to Probability</a></li>
<li class="chapter" data-level="3.2" data-path="probability-introduction.html"><a href="probability-introduction.html#events-sample-spaces-and-sample-points"><i class="fa fa-check"></i><b>3.2</b> Events, sample spaces and sample points</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="probability-introduction.html"><a href="probability-introduction.html#relation-among-events"><i class="fa fa-check"></i><b>3.2.1</b> Relation among events</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="probability-introduction.html"><a href="probability-introduction.html#probability"><i class="fa fa-check"></i><b>3.3</b> Probability</a></li>
<li class="chapter" data-level="3.4" data-path="probability-introduction.html"><a href="probability-introduction.html#conditional-probability"><i class="fa fa-check"></i><b>3.4</b> Conditional probability</a></li>
<li class="chapter" data-level="3.5" data-path="probability-introduction.html"><a href="probability-introduction.html#joint-probability"><i class="fa fa-check"></i><b>3.5</b> Joint probability</a></li>
<li class="chapter" data-level="3.6" data-path="probability-introduction.html"><a href="probability-introduction.html#bayes-theorem"><i class="fa fa-check"></i><b>3.6</b> Bayes theorem</a></li>
<li class="chapter" data-level="3.7" data-path="probability-introduction.html"><a href="probability-introduction.html#probability-distributions"><i class="fa fa-check"></i><b>3.7</b> Probability distributions</a>
<ul>
<li class="chapter" data-level="3.7.1" data-path="probability-introduction.html"><a href="probability-introduction.html#discrete-case"><i class="fa fa-check"></i><b>3.7.1</b> Discrete Case</a></li>
<li class="chapter" data-level="3.7.2" data-path="probability-introduction.html"><a href="probability-introduction.html#continuous-cases"><i class="fa fa-check"></i><b>3.7.2</b> Continuous cases</a></li>
<li class="chapter" data-level="3.7.3" data-path="probability-introduction.html"><a href="probability-introduction.html#histograms"><i class="fa fa-check"></i><b>3.7.3</b> Histograms</a></li>
</ul></li>
<li class="chapter" data-level="3.8" data-path="probability-introduction.html"><a href="probability-introduction.html#example-bayesian-bandits"><i class="fa fa-check"></i><b>3.8</b> Example: Bayesian Bandits</a></li>
<li class="chapter" data-level="3.9" data-path="probability-introduction.html"><a href="probability-introduction.html#summary-1"><i class="fa fa-check"></i><b>3.9</b> Summary</a></li>
<li class="chapter" data-level="3.10" data-path="probability-introduction.html"><a href="probability-introduction.html#references-2"><i class="fa fa-check"></i><b>3.10</b> References</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="spam-filter.html"><a href="spam-filter.html"><i class="fa fa-check"></i><b>4</b> Spam filter</a>
<ul>
<li class="chapter" data-level="4.1" data-path="spam-filter.html"><a href="spam-filter.html#naive-bayes-spam-or-ham"><i class="fa fa-check"></i><b>4.1</b> Naive Bayes: Spam or Ham?</a></li>
<li class="chapter" data-level="4.2" data-path="spam-filter.html"><a href="spam-filter.html#summary-2"><i class="fa fa-check"></i><b>4.2</b> Summary</a></li>
<li class="chapter" data-level="4.3" data-path="spam-filter.html"><a href="spam-filter.html#references-3"><i class="fa fa-check"></i><b>4.3</b> References</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="probabilistic-programming.html"><a href="probabilistic-programming.html"><i class="fa fa-check"></i><b>5</b> Probabilistic programming</a>
<ul>
<li class="chapter" data-level="5.1" data-path="probabilistic-programming.html"><a href="probabilistic-programming.html#coin-flipping-example"><i class="fa fa-check"></i><b>5.1</b> Coin flipping example</a></li>
<li class="chapter" data-level="5.2" data-path="probabilistic-programming.html"><a href="probabilistic-programming.html#summary-3"><i class="fa fa-check"></i><b>5.2</b> Summary</a></li>
<li class="chapter" data-level="5.3" data-path="probabilistic-programming.html"><a href="probabilistic-programming.html#references-4"><i class="fa fa-check"></i><b>5.3</b> References</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="escaping-from-mars.html"><a href="escaping-from-mars.html"><i class="fa fa-check"></i><b>6</b> Escaping from Mars</a>
<ul>
<li class="chapter" data-level="6.1" data-path="escaping-from-mars.html"><a href="escaping-from-mars.html#calculating-the-constant-g-of-mars"><i class="fa fa-check"></i><b>6.1</b> Calculating the constant g of Mars</a></li>
<li class="chapter" data-level="6.2" data-path="escaping-from-mars.html"><a href="escaping-from-mars.html#optimizing-the-throwing-angle"><i class="fa fa-check"></i><b>6.2</b> Optimizing the throwing angle</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="escaping-from-mars.html"><a href="escaping-from-mars.html#calculating-the-escape-velocity"><i class="fa fa-check"></i><b>6.2.1</b> Calculating the escape velocity</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="escaping-from-mars.html"><a href="escaping-from-mars.html#summary-4"><i class="fa fa-check"></i><b>6.3</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="football-simulation.html"><a href="football-simulation.html"><i class="fa fa-check"></i><b>7</b> Football simulation</a>
<ul>
<li class="chapter" data-level="7.1" data-path="football-simulation.html"><a href="football-simulation.html#creating-our-conjectures"><i class="fa fa-check"></i><b>7.1</b> Creating our conjectures</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="football-simulation.html"><a href="football-simulation.html#bayesian-hierarchical-models"><i class="fa fa-check"></i><b>7.1.1</b> Bayesian hierarchical models</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="football-simulation.html"><a href="football-simulation.html#simulate-possible-realities"><i class="fa fa-check"></i><b>7.2</b> Simulate possible realities</a></li>
<li class="chapter" data-level="7.3" data-path="football-simulation.html"><a href="football-simulation.html#summary-5"><i class="fa fa-check"></i><b>7.3</b> Summary</a></li>
<li class="chapter" data-level="7.4" data-path="football-simulation.html"><a href="football-simulation.html#references-5"><i class="fa fa-check"></i><b>7.4</b> References</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="basketball-shots.html"><a href="basketball-shots.html"><i class="fa fa-check"></i><b>8</b> Basketball shots</a>
<ul>
<li class="chapter" data-level="8.1" data-path="basketball-shots.html"><a href="basketball-shots.html#modeling-the-probability-of-scoring"><i class="fa fa-check"></i><b>8.1</b> Modeling the probability of scoring</a></li>
<li class="chapter" data-level="8.2" data-path="basketball-shots.html"><a href="basketball-shots.html#prior-predictive-checks-part-i"><i class="fa fa-check"></i><b>8.2</b> Prior Predictive Checks: Part I</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="basketball-shots.html"><a href="basketball-shots.html#defining-our-model-and-computing-posteriors"><i class="fa fa-check"></i><b>8.2.1</b> Defining our model and computing posteriors</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="basketball-shots.html"><a href="basketball-shots.html#new-model-and-prior-predictive-checks-part-ii"><i class="fa fa-check"></i><b>8.3</b> New model and prior predictive checks: Part II</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="basketball-shots.html"><a href="basketball-shots.html#defining-the-new-model-and-computing-posteriors"><i class="fa fa-check"></i><b>8.3.1</b> Defining the new model and computing posteriors</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="basketball-shots.html"><a href="basketball-shots.html#does-the-period-affect-the-probability-of-scoring"><i class="fa fa-check"></i><b>8.4</b> Does the Period affect the probability of scoring?</a></li>
<li class="chapter" data-level="8.5" data-path="basketball-shots.html"><a href="basketball-shots.html#summary-6"><i class="fa fa-check"></i><b>8.5</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="optimal-pricing.html"><a href="optimal-pricing.html"><i class="fa fa-check"></i><b>9</b> Optimal pricing</a>
<ul>
<li class="chapter" data-level="9.1" data-path="optimal-pricing.html"><a href="optimal-pricing.html#overview"><i class="fa fa-check"></i><b>9.1</b> Overview</a></li>
<li class="chapter" data-level="9.2" data-path="optimal-pricing.html"><a href="optimal-pricing.html#optimal-pricing-1"><i class="fa fa-check"></i><b>9.2</b> Optimal pricing</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="optimal-pricing.html"><a href="optimal-pricing.html#price-vs-quantity-model"><i class="fa fa-check"></i><b>9.2.1</b> Price vs Quantity model</a></li>
<li class="chapter" data-level="9.2.2" data-path="optimal-pricing.html"><a href="optimal-pricing.html#price-elasticity-of-demand"><i class="fa fa-check"></i><b>9.2.2</b> Price elasticity of demand</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="optimal-pricing.html"><a href="optimal-pricing.html#maximizing-profit"><i class="fa fa-check"></i><b>9.3</b> Maximizing profit</a></li>
<li class="chapter" data-level="9.4" data-path="optimal-pricing.html"><a href="optimal-pricing.html#summary-7"><i class="fa fa-check"></i><b>9.4</b> Summary</a></li>
<li class="chapter" data-level="9.5" data-path="optimal-pricing.html"><a href="optimal-pricing.html#references-6"><i class="fa fa-check"></i><b>9.5</b> References</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="image-classification.html"><a href="image-classification.html"><i class="fa fa-check"></i><b>10</b> Image classification</a>
<ul>
<li class="chapter" data-level="10.1" data-path="image-classification.html"><a href="image-classification.html#bee-population-control-what-would-happen-if-bees-go-extinct"><i class="fa fa-check"></i><b>10.1</b> Bee population control: What would happen if bees go extinct?</a></li>
<li class="chapter" data-level="10.2" data-path="image-classification.html"><a href="image-classification.html#machine-learning-overview"><i class="fa fa-check"></i><b>10.2</b> Machine Learning Overview</a></li>
<li class="chapter" data-level="10.3" data-path="image-classification.html"><a href="image-classification.html#neural-networks-and-convolutional-neural-networks"><i class="fa fa-check"></i><b>10.3</b> Neural networks and convolutional neural networks</a></li>
<li class="chapter" data-level="10.4" data-path="image-classification.html"><a href="image-classification.html#summary-8"><i class="fa fa-check"></i><b>10.4</b> Summary</a></li>
<li class="chapter" data-level="10.5" data-path="image-classification.html"><a href="image-classification.html#references-7"><i class="fa fa-check"></i><b>10.5</b> References</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="ultima-online.html"><a href="ultima-online.html"><i class="fa fa-check"></i><b>11</b> Ultima online</a>
<ul>
<li class="chapter" data-level="11.1" data-path="ultima-online.html"><a href="ultima-online.html#the-ultima-online-catastrophe"><i class="fa fa-check"></i><b>11.1</b> The Ultima Online Catastrophe</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="ultima-online.html"><a href="ultima-online.html#the-lotka-volterra-model-for-population-dynamics"><i class="fa fa-check"></i><b>11.1.1</b> The Lotka-Volterra model for population dynamics</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="ultima-online.html"><a href="ultima-online.html#summary-9"><i class="fa fa-check"></i><b>11.2</b> Summary</a></li>
<li class="chapter" data-level="11.3" data-path="ultima-online.html"><a href="ultima-online.html#references-8"><i class="fa fa-check"></i><b>11.3</b> References</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="ultima-continued.html"><a href="ultima-continued.html"><i class="fa fa-check"></i><b>12</b> Ultima continued</a>
<ul>
<li class="chapter" data-level="12.1" data-path="ultima-continued.html"><a href="ultima-continued.html#the-language-of-science"><i class="fa fa-check"></i><b>12.1</b> The language of science</a></li>
<li class="chapter" data-level="12.2" data-path="ultima-continued.html"><a href="ultima-continued.html#scientific-machine-learning-for-model-discovery"><i class="fa fa-check"></i><b>12.2</b> Scientific Machine Learning for model discovery</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="ultima-continued.html"><a href="ultima-continued.html#looking-for-the-catastrophe-culprit"><i class="fa fa-check"></i><b>12.2.1</b> Looking for the catastrophe culprit</a></li>
<li class="chapter" data-level="12.2.2" data-path="ultima-continued.html"><a href="ultima-continued.html#the-infamous-day-begins."><i class="fa fa-check"></i><b>12.2.2</b> The infamous day begins.</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="ultima-continued.html"><a href="ultima-continued.html#summary-10"><i class="fa fa-check"></i><b>12.3</b> Summary</a></li>
<li class="chapter" data-level="12.4" data-path="ultima-continued.html"><a href="ultima-continued.html#references-9"><i class="fa fa-check"></i><b>12.4</b> References</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="time-series.html"><a href="time-series.html"><i class="fa fa-check"></i><b>13</b> Time series</a>
<ul>
<li class="chapter" data-level="13.1" data-path="time-series.html"><a href="time-series.html#predicting-the-future"><i class="fa fa-check"></i><b>13.1</b> Predicting the future</a></li>
<li class="chapter" data-level="13.2" data-path="time-series.html"><a href="time-series.html#exponential-smoothing"><i class="fa fa-check"></i><b>13.2</b> Exponential Smoothing</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="time-series.html"><a href="time-series.html#weighted-average-and-component-form"><i class="fa fa-check"></i><b>13.2.1</b> Weighted average and Component form</a></li>
<li class="chapter" data-level="13.2.2" data-path="time-series.html"><a href="time-series.html#optimization-or-fitting-process"><i class="fa fa-check"></i><b>13.2.2</b> Optimization (or Fitting) Process</a></li>
<li class="chapter" data-level="13.2.3" data-path="time-series.html"><a href="time-series.html#trend-methods"><i class="fa fa-check"></i><b>13.2.3</b> Trend Methods</a></li>
<li class="chapter" data-level="13.2.4" data-path="time-series.html"><a href="time-series.html#seasonality-methods"><i class="fa fa-check"></i><b>13.2.4</b> Seasonality Methods</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="time-series.html"><a href="time-series.html#summary-11"><i class="fa fa-check"></i><b>13.3</b> Summary</a></li>
<li class="chapter" data-level="13.4" data-path="time-series.html"><a href="time-series.html#references-10"><i class="fa fa-check"></i><b>13.4</b> References</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/unbalancedparentheses/data_science_in_julia_for_hackers" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Data Science in Julia for Hackers</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="ultima-online" class="section level1 hasAnchor" number="11">
<h1><span class="header-section-number">Chapter 11</span> Ultima online<a href="ultima-online.html#ultima-online" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="the-ultima-online-catastrophe" class="section level2 hasAnchor" number="11.1">
<h2><span class="header-section-number">11.1</span> The Ultima Online Catastrophe<a href="ultima-online.html#the-ultima-online-catastrophe" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><a href="https://uo.com/">Ultima online</a> is a fantasy massively multiplayer online role-playing game (MMORPG) created by
<a href="https://en.wikipedia.org/wiki/Richard_Garriott">Richard Garriott</a> between 1995 and 1997, when it was realesed.</p>
<p>The game consisted of a medieval fantasy world in which each player could build their own character. What was interesting and disruptive was
that all players interacted with each other, and what one did had repercussions on the general map. So, the game was “alive” in the sense that
if two people were fighting in one area and another one came in, the latter could see that fight. Also, the warriors had to hunt and look for
resources to get points and improve their skills and again, if a treasure was discovered, or an animal was hunted, it would no longer be available
for the rest.</p>
<p>During the development process of the game, Garriott and his team realized that, due to the massiveness of the game, there was going to be a
moment when they would not be able to create content at the same speed as the players were consuming it. So they decided to automate the process.</p>
<p>After a lot of work, one of the ideas they came up with was to generate a “Virtual Ecosystem”. This was a really incredible idea in which a whole
ecosystem in harmony was simulated inside the game. For example, if an area started to grow grass, the herbivorous animals would come and start
eating it. If many animals arrived, they would surely end up eating all the food and would have to go look for other places, it could even happen
that some of them were not lucky and died on the way, starving. In the same way, the carnivorous animals (that is, the predators of the
herbivores) would strive to hunt as many animals as they could, but if in doing so they killed a significant number of them, food would become
scarce causing them to die as well. In this way, as in “real” nature, a beautiful balance was generated.</p>
<p>But how this was even possible?</p>
<div id="the-lotka-volterra-model-for-population-dynamics" class="section level3 hasAnchor" number="11.1.1">
<h3><span class="header-section-number">11.1.1</span> The Lotka-Volterra model for population dynamics<a href="ultima-online.html#the-lotka-volterra-model-for-population-dynamics" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To begin to understand how this complex ecosystem was created, it makes sense to go to the roots and study a dynamical system in which the
interaction between a prey and a predatory population is modeled.</p>
<p>The idea is the same as we mentioned above. In this case, we will have a “prey” population that will have a reproduction rate such that:</p>
<p><span class="math inline">\(PreyPopulation_{t+1} \sim PreyPopulation_{t} * BirthRate\)</span></p>
<p>And a mortality rate that will be also affected by the prey population</p>
<p><span class="math inline">\(Prey Population_{t+1} \sim PreyPopulation_{t}* MortalityRate\)</span></p>
<p>So, representing prey population as <span class="math inline">\(prey\)</span>, birthrate as <span class="math inline">\(b_{prey}\)</span> and mortality rate as <span class="math inline">\(m_{prey}\)</span> for simplicity, we can write this as:</p>
<p><span class="math inline">\(\frac{dprey}{dt} = prey*(b_{prey} - m_{prey})\)</span></p>
<p>The population at time <span class="math inline">\(t\)</span> multiplies at both rates because if the population is zero there can be no births or deaths. This leads us to the
simplest ecological model, in which per capita growth is the difference between the birth rate and the mortality rate.</p>
<div id="parentheses-on-differential-equations" class="section level4 hasAnchor" number="11.1.1.1">
<h4><span class="header-section-number">11.1.1.1</span> Parentheses on differential equations<a href="ultima-online.html#parentheses-on-differential-equations" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Before anyone freaks out, lets talk a little bit about that strange notation.</p>
<p>As we said above, the prey´s population will grow proportionally to the birth rate and the actual population. And we also said that the
population will shrink proportional to the mortality rate and its actual population. Do you realize that we are describing change?</p>
<p>This is exactly what the equation is saying. You can read that horrendous <span class="math inline">\(d\)</span> as change! So, the entire term <span class="math inline">\(\frac{dPrey}{dt}=\)</span> is just
saying “the change of the pupulation over time (that´s why the <span class="math inline">\(dt\)</span> term is deviding there) is equal to…” and that’s it!</p>
<p>These equations, in contrast to the usual equations we are used to, have a function as the unkown value we have to solve for. Having a differential
equation of the form</p>
<p><span class="math inline">\(\frac{du}{dt} = f(u, t)\)</span></p>
<p>reads: “give me the function <span class="math inline">\(u(t)\)</span> whos derivative for each <span class="math inline">\(u\)</span> and <span class="math inline">\(t\)</span> is <span class="math inline">\(f(u, t)\)</span>. There is no silver bullet for solving these type of
equations. In some cases, you can solve them analytically using different methods depending on the particular equation, which gives you an
expression for the solution function. But more often, numerical methods are used to obtain an approximation of the function in some range,
with the help of computers. We will focus on introducing how to solve systems of ordinary differential equations, the simplest type of differential
equations, using the awesome tools from the <a href="https://sciml.ai/">SciML</a> Julia ecosystem.</p>
<p>Differential equations can be a difficult concept to understand because we are very used to work with absolute values. But sometimes (in fact, very often) it is
much more easier to describe change over absolute values. And this is one of this cases. But, for now, lets leave this up to here, we will take
it up again in the next chapter.</p>
</div>
<div id="returning-to-lotka-volterra" class="section level4 hasAnchor" number="11.1.1.2">
<h4><span class="header-section-number">11.1.1.2</span> Returning to Lotka-Volterra<a href="ultima-online.html#returning-to-lotka-volterra" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The model we are looking for has to explain the interaction between the two species. To do so, we must include the pradator population in
order to modify the mortality rate of the prey, leaving us with:</p>
<p><span class="math inline">\(\frac{dprey}{dt} = prey*(b_{prey} - m_{prey}*pred)\)</span></p>
<p>In a similar way we can think the interaction on the side of the predator, where the mortality rate would be constant and the birth rate will
depend upon the prey population:</p>
<p><span class="math inline">\(\frac{dpred}{dt} = pred*(b_{pred}*prey - m_{pred})\)</span></p>
<p>In this way we obtain the Lotka-Volterra model in which the population dynamics is determined by a system of coupled ordinal differential
equations (from now on, ODEs). This is a simplified but powerful model which tells us how a hunter-prey system will oscillate without finding
stable values for their populations.</p>
</div>
<div id="sciml-to-simulate-population-dynamics" class="section level4 hasAnchor" number="11.1.1.3">
<h4><span class="header-section-number">11.1.1.3</span> SciML to simulate population dynamics<a href="ultima-online.html#sciml-to-simulate-population-dynamics" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We will use the <code>DifferentialEquations.jl</code> package to define and solve our ODE problem. First, we should define a function that encompasses the
information of our Lotka-Volterra model in the way required by the package:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb1-1"><a href="ultima-online.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">lotka_volterra!</span>(du, u, p, t)</span>
<span id="cb1-2"><a href="ultima-online.html#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Unpack the values so that they have clearer meaning</span></span>
<span id="cb1-3"><a href="ultima-online.html#cb1-3" aria-hidden="true" tabindex="-1"></a>  prey, pred  <span class="op">=</span> u</span>
<span id="cb1-4"><a href="ultima-online.html#cb1-4" aria-hidden="true" tabindex="-1"></a>  birth_prey, mort_prey, birth_pred, mort_pred <span class="op">=</span> p</span>
<span id="cb1-5"><a href="ultima-online.html#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="ultima-online.html#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Define the ODE</span></span>
<span id="cb1-7"><a href="ultima-online.html#cb1-7" aria-hidden="true" tabindex="-1"></a>  du[<span class="fl">1</span>] <span class="op">=</span> (birth_prey <span class="op">-</span> mort_prey <span class="op">*</span> pred) <span class="op">*</span> prey</span>
<span id="cb1-8"><a href="ultima-online.html#cb1-8" aria-hidden="true" tabindex="-1"></a>  du[<span class="fl">2</span>] <span class="op">=</span> (birth_pred <span class="op">*</span> prey <span class="op">-</span> mort_pred) <span class="op">*</span> pred</span>
<span id="cb1-9"><a href="ultima-online.html#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<p>The defined function should have four arguments:
* <span class="math inline">\(du\)</span> represents the derivatives of the state variables (in our case, dprey and dpred).
* <span class="math inline">\(u\)</span> represents the state variables themselves (prey, pred).
* <span class="math inline">\(p\)</span> represents the parameters of the model (birth and mortality rates).
* <span class="math inline">\(t\)</span> represents time.</p>
<p>To fully define our ODE problem, me should wrap our model, the initial values of the populations (initial conditions), the parameter values and
the time span of the solution (in what range of time we want our solution to be calculated) into a <code>ODEProblem</code> struct from the
<code>DifferentialEquations.jl</code> package.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb2-1"><a href="ultima-online.html#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Model parameters</span></span>
<span id="cb2-2"><a href="ultima-online.html#cb2-2" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> [<span class="fl">1.1</span>, <span class="fl">0.5</span>, <span class="fl">0.1</span>, <span class="fl">0.2</span>]</span>
<span id="cb2-3"><a href="ultima-online.html#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="ultima-online.html#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Initial conditions</span></span>
<span id="cb2-5"><a href="ultima-online.html#cb2-5" aria-hidden="true" tabindex="-1"></a>u0 <span class="op">=</span> [<span class="fl">1</span>, <span class="fl">1</span>]</span>
<span id="cb2-6"><a href="ultima-online.html#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="ultima-online.html#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Timespan of the solution</span></span>
<span id="cb2-8"><a href="ultima-online.html#cb2-8" aria-hidden="true" tabindex="-1"></a>tspan <span class="op">=</span> (<span class="fl">0.0</span>, <span class="fl">40.0</span>)</span>
<span id="cb2-9"><a href="ultima-online.html#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="ultima-online.html#cb2-10" aria-hidden="true" tabindex="-1"></a>prob <span class="op">=</span> <span class="fu">ODEProblem</span>(lotka_volterra!, u0, tspan, p)</span></code></pre></div>
<p>With all these, we are now ready for calculating a solution for our problem! This is done with the <code>solve</code> function:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb3-1"><a href="ultima-online.html#cb3-1" aria-hidden="true" tabindex="-1"></a>sol <span class="op">=</span> <span class="fu">solve</span>(prob)</span></code></pre></div>
<p>We now have two functions that represent the populations of preys and predators with respect to time, between 0 and 40. We have not specified any
unit for time here, but you can think of it in years if you want. Let’s plot the two solutions and see what we got</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb4-1"><a href="ultima-online.html#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sol)</span></code></pre></div>
<p><img src="data_science_in_julia_for_hackers_files/figure-html/chap_11_plot_1-J1.png" /><!-- --></p>
<p>In this beautiful plot we can clearly see how both species interact: when there are very few members of the prey population, the predators can’t
reproduce because there is no food for them, but as the prey population grows, so does the predator population. When there are too many predators,
the prey population starts to decrease and finally when there are too little of these, the predator population also shrinks since there is not
enough food for the entire population. This cycle repeats over and over.</p>
</div>
<div id="obtaining-the-model-from-the-data" class="section level4 hasAnchor" number="11.1.1.4">
<h4><span class="header-section-number">11.1.1.4</span> Obtaining the model from the data<a href="ultima-online.html#obtaining-the-model-from-the-data" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Back to the terrible case of Ultima Online. Suppose we had data on the population of predators and prey that were in harmony during the game at
a given time. If we wanted to venture out and analyze what parameters Garriot and his team used to model their great ecosystem, would it be
possible? Of course it is, we just need to add a little Bayesianism.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb5-1"><a href="ultima-online.html#cb5-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> CSV.<span class="fu">read</span>(<span class="st">&quot;./11_ultima_online/ultima_online_data.csv&quot;</span>, DataFrame)</span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb6-1"><a href="ultima-online.html#cb6-1" aria-hidden="true" tabindex="-1"></a>ultima_online <span class="op">=</span> <span class="fu">Array</span>(data)<span class="ch">&#39;</span></span></code></pre></div>
<pre><code>## 2×16 adjoint(::Matrix{Float64}) with eltype Float64:
##  1.0  2.44646   4.90536  2.32078  0.670135  …  2.61348   4.97878  2.08182
##  1.0  0.852693  1.7076   3.90827  2.88228      0.864201  1.86019  3.9374</code></pre>
<p>Observing this data in a table is probably not being very enlightening. Let’s plot it and see if it makes sense with what we have been discussing:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb8-1"><a href="ultima-online.html#cb8-1" aria-hidden="true" tabindex="-1"></a>time <span class="op">=</span> <span class="fu">collect</span>(<span class="fl">0</span><span class="op">:</span><span class="fl">2</span><span class="op">:</span><span class="fl">30</span>);</span>
<span id="cb8-2"><a href="ultima-online.html#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">scatter</span>(time, ultima_online[<span class="fl">1</span>, <span class="op">:</span>], label<span class="op">=</span><span class="st">&quot;Prey&quot;</span>);</span>
<span id="cb8-3"><a href="ultima-online.html#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">scatter!</span>(time, ultima_online[<span class="fl">2</span>, <span class="op">:</span>], label<span class="op">=</span><span class="st">&quot;Pred&quot;</span>)</span></code></pre></div>
<p><img src="data_science_in_julia_for_hackers_files/figure-html/chap_11_plot_2-J1.png" /><!-- --></p>
<p>Can you spot the pattern? Let’s connect the dots to make our work easier</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb9-1"><a href="ultima-online.html#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(time, ultima_online[<span class="fl">1</span>,<span class="op">:</span>], label<span class="op">=</span><span class="cn">false</span>);</span>
<span id="cb9-2"><a href="ultima-online.html#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot!</span>(time, ultima_online[<span class="fl">2</span>, <span class="op">:</span>], label<span class="op">=</span><span class="cn">false</span>);</span>
<span id="cb9-3"><a href="ultima-online.html#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">scatter!</span>(time, ultima_online[<span class="fl">1</span>, <span class="op">:</span>], label<span class="op">=</span><span class="st">&quot;Prey&quot;</span>);</span>
<span id="cb9-4"><a href="ultima-online.html#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="fu">scatter!</span>(time, ultima_online[<span class="fl">2</span>, <span class="op">:</span>], label<span class="op">=</span><span class="st">&quot;Pred&quot;</span>)</span></code></pre></div>
<p><img src="data_science_in_julia_for_hackers_files/figure-html/chap_11_plot_3-J1.png" /><!-- --></p>
<p>Well, this already looks much nicer, but could you venture to say what are the parameters that govern it?
This task that seems impossible a priori, is easily achievable with the SciML engine:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb10-1"><a href="ultima-online.html#cb10-1" aria-hidden="true" tabindex="-1"></a>u_init <span class="op">=</span> [<span class="fl">1</span>, <span class="fl">1</span>]</span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb11-1"><a href="ultima-online.html#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">fitlv</span>(data)</span>
<span id="cb11-2"><a href="ultima-online.html#cb11-2" aria-hidden="true" tabindex="-1"></a>    σ <span class="op">~</span> <span class="fu">InverseGamma</span>(<span class="fl">2</span>, <span class="fl">3</span>)</span>
<span id="cb11-3"><a href="ultima-online.html#cb11-3" aria-hidden="true" tabindex="-1"></a>    birth_prey <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(<span class="fl">1</span>, <span class="fl">0.5</span>), <span class="fl">0</span>, <span class="fl">2</span>)</span>
<span id="cb11-4"><a href="ultima-online.html#cb11-4" aria-hidden="true" tabindex="-1"></a>    mort_prey <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(<span class="fl">1</span>, <span class="fl">0.5</span>), <span class="fl">0</span>, <span class="fl">2</span>)</span>
<span id="cb11-5"><a href="ultima-online.html#cb11-5" aria-hidden="true" tabindex="-1"></a>    birth_pred <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(<span class="fl">1</span>, <span class="fl">0.5</span>), <span class="fl">0</span>, <span class="fl">2</span>)</span>
<span id="cb11-6"><a href="ultima-online.html#cb11-6" aria-hidden="true" tabindex="-1"></a>    mort_pred <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(<span class="fl">1</span>, <span class="fl">0.5</span>), <span class="fl">0</span>, <span class="fl">2</span>)</span>
<span id="cb11-7"><a href="ultima-online.html#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="ultima-online.html#cb11-8" aria-hidden="true" tabindex="-1"></a>    k <span class="op">=</span> [birth_prey, mort_prey, birth_pred, mort_pred]</span>
<span id="cb11-9"><a href="ultima-online.html#cb11-9" aria-hidden="true" tabindex="-1"></a>    prob <span class="op">=</span> <span class="fu">ODEProblem</span>(lotka_volterra, u_init, (<span class="fl">0.0</span>, <span class="fl">30</span>), k)</span>
<span id="cb11-10"><a href="ultima-online.html#cb11-10" aria-hidden="true" tabindex="-1"></a>    predicted <span class="op">=</span> <span class="fu">solve</span>(prob, <span class="fu">Tsit5</span>(), saveat<span class="op">=</span><span class="fl">2</span>)</span>
<span id="cb11-11"><a href="ultima-online.html#cb11-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-12"><a href="ultima-online.html#cb11-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu">length</span>(predicted)</span>
<span id="cb11-13"><a href="ultima-online.html#cb11-13" aria-hidden="true" tabindex="-1"></a>        data[<span class="op">:</span>, i] <span class="op">~</span> <span class="fu">MvNormal</span>(predicted[i], σ)</span>
<span id="cb11-14"><a href="ultima-online.html#cb11-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb11-15"><a href="ultima-online.html#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb12-1"><a href="ultima-online.html#cb12-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">fitlv</span>(ultima_online)</span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb13-1"><a href="ultima-online.html#cb13-1" aria-hidden="true" tabindex="-1"></a>posterior <span class="op">=</span> <span class="fu">sample</span>(model, <span class="fu">NUTS</span>(<span class="fl">0.6</span>), <span class="fl">10000</span>); </span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb14-1"><a href="ultima-online.html#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(posterior)</span></code></pre></div>
<p><img src="data_science_in_julia_for_hackers_files/figure-html/chap_11_plot_4-J1.png" /><!-- --></p>
<p>So, our model is pretty sure that the parameters used by Garriott for the birth and death rate were around 0.8 and 0.4 for the prey population.
For the prey the values were around 0.2 and 0.4. The chains of the sampling process are really healthy, so we can be
confident that the answers we obtain are correct. Take a moment to think about this.</p>
<p>Let’s stop for a second to appreciate the really complex calculation that we have just done. Until now we always made Bayesian inference in
linear models that anyway required us to use complex mechanisms to be able to sample the distributions a posteriori of our parameters.</p>
<p>The powerful SciML engine allows us to make Bayesian inferences but from dynamical systems of differential equations! That is, now we can get into
an even higher level of complexity for our models, keeping the advantage of being able to have a quantification of the uncertainty we are
working with, among other advantages that the Bayesian framework gives us.</p>
</div>
<div id="visualizing-the-results" class="section level4 hasAnchor" number="11.1.1.5">
<h4><span class="header-section-number">11.1.1.5</span> Visualizing the results<a href="ultima-online.html#visualizing-the-results" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>As always, it is very interesting to be able to observe the uncertainty that Bayesianism provides us within our model.</p>
<p>First we should make a smaller sampling of the distributions of each parameter so that the number of models we plot does not become a
problem when visualizing:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb15-1"><a href="ultima-online.html#cb15-1" aria-hidden="true" tabindex="-1"></a>birth_prey <span class="op">=</span> <span class="fu">sample</span>(<span class="fu">collect</span>(<span class="fu">get</span>(posterior, <span class="op">:</span>birth_prey)[<span class="fl">1</span>]), <span class="fl">100</span>)</span>
<span id="cb15-2"><a href="ultima-online.html#cb15-2" aria-hidden="true" tabindex="-1"></a>mort_prey <span class="op">=</span> <span class="fu">sample</span>(<span class="fu">collect</span>(<span class="fu">get</span>(posterior, <span class="op">:</span>mort_prey)[<span class="fl">1</span>]), <span class="fl">100</span>)</span>
<span id="cb15-3"><a href="ultima-online.html#cb15-3" aria-hidden="true" tabindex="-1"></a>birth_pred <span class="op">=</span> <span class="fu">sample</span>(<span class="fu">collect</span>(<span class="fu">get</span>(posterior, <span class="op">:</span>birth_pred)[<span class="fl">1</span>]), <span class="fl">100</span>)</span>
<span id="cb15-4"><a href="ultima-online.html#cb15-4" aria-hidden="true" tabindex="-1"></a>mort_pred <span class="op">=</span> <span class="fu">sample</span>(<span class="fu">collect</span>(<span class="fu">get</span>(posterior, <span class="op">:</span>mort_pred)[<span class="fl">1</span>]), <span class="fl">100</span>)</span></code></pre></div>
<p>And now let’s solve the system of differential equations for each of the combinations of parameters that we got, saving them in solutions so
that we can use this array in the plotting later. One additional solution was added using the mean of each parameter.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb16-1"><a href="ultima-online.html#cb16-1" aria-hidden="true" tabindex="-1"></a>solutions <span class="op">=</span> []</span>
<span id="cb16-2"><a href="ultima-online.html#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu">length</span>(birth_prey)</span>
<span id="cb16-3"><a href="ultima-online.html#cb16-3" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> [birth_prey[i], mort_prey[i], birth_pred[i], mort_pred[i]]</span>
<span id="cb16-4"><a href="ultima-online.html#cb16-4" aria-hidden="true" tabindex="-1"></a>    problem <span class="op">=</span> <span class="fu">ODEProblem</span>(lotka_volterra, u0, (<span class="fl">0.0</span>, <span class="fl">30.0</span>), p)</span>
<span id="cb16-5"><a href="ultima-online.html#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">push!</span>(solutions, <span class="fu">solve</span>(problem, saveat <span class="op">=</span> <span class="fl">0.1</span>))</span>
<span id="cb16-6"><a href="ultima-online.html#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb16-7"><a href="ultima-online.html#cb16-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-8"><a href="ultima-online.html#cb16-8" aria-hidden="true" tabindex="-1"></a>p_mean <span class="op">=</span> [<span class="fu">mean</span>(birth_prey), <span class="fu">mean</span>(mort_prey), <span class="fu">mean</span>(birth_pred), <span class="fu">mean</span>(mort_pred)]</span>
<span id="cb16-9"><a href="ultima-online.html#cb16-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-10"><a href="ultima-online.html#cb16-10" aria-hidden="true" tabindex="-1"></a>problem1 <span class="op">=</span> <span class="fu">ODEProblem</span>(lotka_volterra!, u0, (<span class="fl">0.0</span>,<span class="fl">30.0</span>), p_mean)</span>
<span id="cb16-11"><a href="ultima-online.html#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="fu">push!</span>(solutions, <span class="fu">solve</span>(problem1, saveat <span class="op">=</span> <span class="fl">0.1</span>))</span></code></pre></div>
<p>The last step is simply to plot each of the models we generate. I also added the data points with which we infer all the model, to be able to
appreciate the almost perfect fit:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb17-1"><a href="ultima-online.html#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the differents models we infer</span></span>
<span id="cb17-2"><a href="ultima-online.html#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(solutions[<span class="fl">1</span>], alpha<span class="op">=</span><span class="fl">0.2</span>, color<span class="op">=</span><span class="st">&quot;blue&quot;</span>);</span>
<span id="cb17-3"><a href="ultima-online.html#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span>(<span class="fu">length</span>(solutions) <span class="op">-</span> <span class="fl">1</span>)</span>
<span id="cb17-4"><a href="ultima-online.html#cb17-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot!</span>(solutions[i], alpha<span class="op">=</span><span class="fl">0.2</span>, legend<span class="op">=</span><span class="cn">false</span>, color<span class="op">=</span><span class="st">&quot;blue&quot;</span>);</span>
<span id="cb17-5"><a href="ultima-online.html#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb17-6"><a href="ultima-online.html#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot!</span>(solutions[<span class="kw">end</span>], lw <span class="op">=</span> <span class="fl">2</span>, color<span class="op">=</span><span class="st">&quot;red&quot;</span>);</span>
<span id="cb17-7"><a href="ultima-online.html#cb17-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-8"><a href="ultima-online.html#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Contrasting them with the data</span></span>
<span id="cb17-9"><a href="ultima-online.html#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="fu">scatter!</span>(time, ultima_online[<span class="fl">1</span>, <span class="op">:</span>], color <span class="op">=</span> <span class="st">&quot;blue&quot;</span>);</span>
<span id="cb17-10"><a href="ultima-online.html#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="fu">scatter!</span>(time, ultima_online[<span class="fl">2</span>, <span class="op">:</span>], color <span class="op">=</span> <span class="st">&quot;orange&quot;</span>)</span></code></pre></div>
<p><img src="data_science_in_julia_for_hackers_files/figure-html/chap_11_plot_5-J1.png" /><!-- --></p>
<p>And that’s how we get our model fitted to the data, with a powerful visualization of the uncertainty we handle.</p>
<p>But let’s stop for a second… The title of this chapter has the word “catastrophe” in it, but we just made a beautiful graph showing a Bayesian
inference about the parameters of a system of differential equations. So, what gives that terrible name to our -for now- beautiful chapter?</p>
</div>
<div id="the-virtual-catastrophe" class="section level4 hasAnchor" number="11.1.1.6">
<h4><span class="header-section-number">11.1.1.6</span> The virtual catastrophe<a href="ultima-online.html#the-virtual-catastrophe" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>So far we know that Garriott and his team created a gigantic and highly complex ecological system, where the animals interacted with each other
reaching natural balances.</p>
<p>Also, as expected when the players were included, they would hunt some animals to find resources or to defend themselves from dangerous
carnivores. This was also taken into account, making the dynamic system capable of absorbing this “new” source of mortality, and reaching a
balance again.</p>
<p>This would be the equivalent of adding a player-induced mortality rate in the prey and predators of our Lotka-volterra model:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb18-1"><a href="ultima-online.html#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">lotka_volterra_players!</span>(du,u,p,t)</span>
<span id="cb18-2"><a href="ultima-online.html#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Lotka-Volterra function with players that hunt</span></span>
<span id="cb18-3"><a href="ultima-online.html#cb18-3" aria-hidden="true" tabindex="-1"></a>  prey, pred  <span class="op">=</span> u</span>
<span id="cb18-4"><a href="ultima-online.html#cb18-4" aria-hidden="true" tabindex="-1"></a>  birth_prey, mort_prey, birth_pred, mort_pred, players_prey, players_pred <span class="op">=</span> p</span>
<span id="cb18-5"><a href="ultima-online.html#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="ultima-online.html#cb18-6" aria-hidden="true" tabindex="-1"></a>  du[<span class="fl">1</span>] <span class="op">=</span> dprey <span class="op">=</span> (birth_prey <span class="op">-</span> mort_prey <span class="op">*</span> pred <span class="op">-</span> players_prey)<span class="op">*</span>prey</span>
<span id="cb18-7"><a href="ultima-online.html#cb18-7" aria-hidden="true" tabindex="-1"></a>  du[<span class="fl">2</span>] <span class="op">=</span> dpred <span class="op">=</span> (birth_pred <span class="op">*</span> prey <span class="op">-</span> mort_pred <span class="op">-</span> players_pred)<span class="op">*</span>pred</span>
<span id="cb18-8"><a href="ultima-online.html#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb19-1"><a href="ultima-online.html#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">collect</span>(<span class="fu">get</span>(posterior, <span class="op">:</span>birth_prey)[<span class="fl">1</span>]))   </span></code></pre></div>
<pre><code>## 0.8008260229628938</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb21-1"><a href="ultima-online.html#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">collect</span>(<span class="fu">get</span>(posterior, <span class="op">:</span>birth_pred)[<span class="fl">1</span>]))</span></code></pre></div>
<pre><code>## 0.19986617147029836</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb23-1"><a href="ultima-online.html#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">collect</span>(<span class="fu">get</span>(posterior, <span class="op">:</span>mort_prey)[<span class="fl">1</span>]))</span></code></pre></div>
<pre><code>## 0.40038147117421174</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb25-1"><a href="ultima-online.html#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">collect</span>(<span class="fu">get</span>(posterior, <span class="op">:</span>mort_pred)[<span class="fl">1</span>]))</span></code></pre></div>
<pre><code>## 0.3996181598135257</code></pre>
<p>We will then hypothesize that the parameters chosen to model the virtual ecology were 0.8 and 0.4, and 0.2 and 0.4 for the birth and death rates
of the prey and predator, respectively.</p>
<p>Let’s see what would happen if the players added a mortality rate of 0.4 for both animals, which would be to assume that they kill as much as
the “natural” deaths that were already occurring.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb27-1"><a href="ultima-online.html#cb27-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="op">=</span> [<span class="fl">0.8</span>, <span class="fl">0.4</span>, <span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.4</span>, <span class="fl">0.4</span>] </span>
<span id="cb27-2"><a href="ultima-online.html#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="co"># These last two 0.4 are the ones we are going to attribute to the players </span></span>
<span id="cb27-3"><a href="ultima-online.html#cb27-3" aria-hidden="true" tabindex="-1"></a>u0 <span class="op">=</span> [<span class="fl">1</span>,<span class="fl">1</span>]</span>
<span id="cb27-4"><a href="ultima-online.html#cb27-4" aria-hidden="true" tabindex="-1"></a>prob_players <span class="op">=</span> <span class="fu">ODEProblem</span>(lotka_volterra_players!, u0, (<span class="fl">0.0</span>,<span class="fl">30.0</span>), p1)</span></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb28-1"><a href="ultima-online.html#cb28-1" aria-hidden="true" tabindex="-1"></a>sol_players <span class="op">=</span> <span class="fu">solve</span>(prob_players);</span></code></pre></div>
<div class="sourceCode" id="cb29"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb29-1"><a href="ultima-online.html#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sol_players)</span></code></pre></div>
<p><img src="data_science_in_julia_for_hackers_files/figure-html/chap_11_plot_6-J1.png" /><!-- --></p>
<p>As you can see, the players could hunt enough to double the mortality rate of both animals, and the system would still be in balance. More
herbivores would be observed (because they have a higher birth rate, and there would now be fewer carnivores) and the phase - the time it takes
for a full cycle of population decline and rise - would be delayed.</p>
<p>The creators of the game even assumed that the players would hunt mostly carnivores, because they would be rewarded with higher scores and
resources (and because they would also have to defend themselves from the fierce attacks of the carnivores). The balance would be maintained
anyway:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb30-1"><a href="ultima-online.html#cb30-1" aria-hidden="true" tabindex="-1"></a>p2 <span class="op">=</span> [<span class="fl">0.8</span>, <span class="fl">0.4</span>, <span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>] </span>
<span id="cb30-2"><a href="ultima-online.html#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 0.6 player-induced mortality rate for carnivores  </span></span>
<span id="cb30-3"><a href="ultima-online.html#cb30-3" aria-hidden="true" tabindex="-1"></a>prob_players_ <span class="op">=</span> <span class="fu">ODEProblem</span>(lotka_volterra_players!, u0, (<span class="fl">0.0</span>, <span class="fl">30.0</span>), p2)</span></code></pre></div>
<div class="sourceCode" id="cb31"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb31-1"><a href="ultima-online.html#cb31-1" aria-hidden="true" tabindex="-1"></a>sol_players_ <span class="op">=</span> <span class="fu">solve</span>(prob_players_);</span></code></pre></div>
<div class="sourceCode" id="cb32"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb32-1"><a href="ultima-online.html#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sol_players_, legend<span class="op">=</span><span class="cn">false</span>)</span></code></pre></div>
<p><img src="data_science_in_julia_for_hackers_files/figure-html/chap_11_plot_7-J1.png" /><!-- --></p>
<p>However, even with all the delicate planning of more than 3 years by Garriott and his team, the entire magnificent virtual ecosystem they had
built was destroyed the very second the game was launched.</p>
<p>What they never imagined is that the players, in the same instant that the game started, began what was the biggest mass murder ever seen in
the history of video games. All the logic was exceeded. The players were not attacking the carnivores in search of high scores and resources,
but were completely focused on killing any animal that crossed their path.</p>
<p>The motivation was to kill, rather than logically collect resources, so strategies such as minimizing the points obtained by hunting herbivores
and increasing those obtained by hunting carnivores did not work. All logic was exceeded.</p>
<p>This irrationality made the mortality rate of herbivores much higher than any possible birth rate, causing the whole ecosystem to break down.
Without herbivores, there was no food for carnivores…</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb33-1"><a href="ultima-online.html#cb33-1" aria-hidden="true" tabindex="-1"></a>crazy_killer_players <span class="op">=</span> [<span class="fl">0.8</span>, <span class="fl">0.4</span>, <span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">1</span>, <span class="fl">0.8</span>] </span>
<span id="cb33-2"><a href="ultima-online.html#cb33-2" aria-hidden="true" tabindex="-1"></a>prob_crazy_players <span class="op">=</span> <span class="fu">ODEProblem</span>(lotka_volterra_players!, u0, (<span class="fl">0.0</span>,<span class="fl">30.0</span>), crazy_killer_players)</span></code></pre></div>
<div class="sourceCode" id="cb34"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb34-1"><a href="ultima-online.html#cb34-1" aria-hidden="true" tabindex="-1"></a>sol_crazy_players <span class="op">=</span> <span class="fu">solve</span>(prob_crazy_players)</span></code></pre></div>
<div class="sourceCode" id="cb35"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb35-1"><a href="ultima-online.html#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sol_crazy_players, legend<span class="op">=</span><span class="cn">false</span>)</span></code></pre></div>
<p><img src="data_science_in_julia_for_hackers_files/figure-html/chap_11_plot_8-J1.png" /><!-- --></p>
<p>This sad story ends with the whole beautiful virtual ecosystem, planned for 3 years, destroyed in seconds. The animals of the medieval world that
Garriott and his team had imagined had to be eliminated… In case you want to know more about this, you can listen to the story from the mouth
of the protagonist himself <a href="https://www.youtube.com/watch?v=KFNxJVTJleE&amp;ab_channel=ArsTechnica">here</a></p>
<p>But like every difficult moment, this one also left great lessons. From that moment on, the games started to been tested with real people during
the whole development process. The idea that you could predict the behavior of millions of players was finished, and they started to test instead.</p>
<p>This was the beginning of a very Bayesian way of thinking, in which we start with a priori hypotheses that are tested with reality to modify
the old beliefs, and gain a deeper understanding of what is really happening.</p>
<p>It makes sense, doesn’t it? After all, getting comfortable with our beliefs never is a very good option, and going out into the world to learn
new things seem like a more interesting one.</p>
</div>
</div>
</div>
<div id="summary-9" class="section level2 hasAnchor" number="11.2">
<h2><span class="header-section-number">11.2</span> Summary<a href="ultima-online.html#summary-9" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In this chapter we have learned about the usefulness of differential equations for modeling complex relationships occurring in nature,
specifically the Lotka-Volterra model. We used Turing and some SciML libraries to estimate the model parameters given some data points of
two species, hunter and prey, interacting with each other. Finally, we build an intuition of how the system is modified by varying the value of
certain parameters.</p>
</div>
<div id="references-8" class="section level2 hasAnchor" number="11.3">
<h2><span class="header-section-number">11.3</span> References<a href="ultima-online.html#references-8" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li><a href="https://sciml.ai/">SciML</a></li>
<li><a href="https://turing.ml/dev/tutorials/10-bayesiandiffeq/">Turing Bayesian Differential Equation</a></li>
<li><a href="https://www.youtube.com/watch?v=KFNxJVTJleE&amp;ab_channel=ArsTechnica">Garriot telling the Story</a></li>
</ul>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="image-classification.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="ultima-continued.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["data_science_in_julia_for_hackers.pdf", "data_science_in_julia_for_hackers.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
